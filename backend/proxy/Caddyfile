:{$PORT} {
    log

    # Redirection de la racine vers /portfolio/
    redir / /portfolio/ 301

    handle /health {
        respond "OK" 200
    }

    # Route pour l'API avec authentification de service
    handle_path /api/* {
        authp {
            gcp
            set audience {$API_SERVICE_URL}
        }
        reverse_proxy {$API_SERVICE_URL}
    }

    # Route pour le portfolio avec authentification de service et gestion du SPA
    handle_path /portfolio/* {
        try_files {path} /index.html
        authp {
            gcp
            set audience {$PORTFOLIO_SERVICE_URL}
        }
        reverse_proxy {$PORTFOLIO_SERVICE_URL}
    }
}